# LaTeX Compile Feature Design

**Issue:** deco-9rm
**Date:** 2026-01-31
**Status:** Approved

## Overview

Add a `deco compile` command that generates a print-ready LaTeX GDD document from the design graph. Produces professional, typeset output suitable for stakeholders, publishers, or physical reference.

## Command Interface

```
deco compile -o <output.tex>
```

**Flags:**
- `-o, --output` (required): Output file path for the generated LaTeX

**Behavior:**
- Loads all nodes from `.deco/nodes/`
- Validates project is initialized (`.deco/config.yaml` exists)
- Generates a complete LaTeX document
- Writes to the specified output file

**Error cases:**
- No `.deco/` directory → "not a deco project, run deco init"
- No nodes found → "no nodes to compile"
- Can't write output file → "failed to write output: <reason>"

## Document Structure

```latex
\documentclass[11pt,a4paper]{report}
% Preamble: packages for tables, colors, hyperlinks

\title{<project name from config>}
\author{Generated by Deco}
\date{\today}

\begin{document}
\maketitle
\tableofcontents

\chapter{Systems}
  \section{Settlement}
    \subsection{Colonists}
      % Node content here

\chapter{Events}
  % ...
\end{document}
```

**Hierarchy mapping:**
- Top-level path segment → `\chapter{}` (systems, events, etc.)
- Second-level → `\section{}`
- Third-level → `\subsection{}`
- Deeper levels → `\subsubsection{}` or bold headings

**Ordering:** Alphabetical within each level.

**Title casing:** Path segments capitalized. Node titles override when available.

## Node Rendering

Each node renders these elements:

**Header area:**
- Status badge: `[DRAFT]`, `[APPROVED]`, etc.
- Tags as inline labels
- Summary/one-liner in italics

**Content blocks:**

| Block Type | LaTeX Rendering |
|------------|-----------------|
| `table` | `tabular` with headers and borders |
| `rule` | Indented block quote |
| `param` | Key-value: **key**: value |
| `mechanic` | Named box with description, conditions, outputs |
| `list` | Bulleted `itemize` |

**References section:**
- "Uses:" with hyperlinked node IDs
- "Related:" same treatment
- Events and vocabulary if present

**Issues section:**
- Warning box at end of node
- Shows TBD/question items with severity
- Makes incomplete nodes visually obvious

**Cross-references:** Node IDs become `\hyperref` links.

## Content Scope

**Included:**
- Meta (title, status, tags)
- Summary
- Content blocks (tables, rules, params, mechanics, lists)
- References
- Issues

**Excluded:**
- Contracts (implementation detail)
- Constraints (internal validation)
- llm_context (internal)

## Implementation

**Code organization:**

```
internal/
  cli/
    compile.go          # Command definition, flags
  services/
    compile/
      latex.go          # LaTeX generation logic
      latex_test.go     # Unit tests
```

**Key components:**

1. **LatexCompiler** - Main struct
   - `Compile(nodes []domain.Node, config domain.Config) (string, error)`

2. **Block renderers** - Per-type functions
   - `renderTable()`, `renderRule()`, `renderParam()`, etc.

**LaTeX packages:**
- `hyperref` - Cross-references
- `booktabs` - Tables
- `xcolor` - Colors
- `geometry` - Margins
- `enumitem` - Lists
- `tcolorbox` - Boxes for mechanics/issues

**No external Go dependencies.** Pure string building with proper escaping of LaTeX special characters.

## Testing

Unit tests with example nodes verifying:
- Correct document structure
- Each block type renders properly
- Special characters escaped
- Cross-references generated

No PDF compilation in tests.
