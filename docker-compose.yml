services:
  deco:
    build: .
    restart: unless-stopped
    environment:
      # Claude Code config directory (persists auth across rebuilds)
      - CLAUDE_CONFIG_DIR=/home/claude/.claude-config
      # Git identity
      - GIT_AUTHOR_NAME=${GIT_AUTHOR_NAME:-Claude}
      - GIT_AUTHOR_EMAIL=${GIT_AUTHOR_EMAIL:-claude@example.com}
      - GIT_COMMITTER_NAME=${GIT_COMMITTER_NAME:-Claude}
      - GIT_COMMITTER_EMAIL=${GIT_COMMITTER_EMAIL:-claude@example.com}
    volumes:
      # Project workspace
      - .:/workspace

      # Claude Code config (auth + settings, survives rebuilds)
      - claude-config:/home/claude/.claude-config

      # Git config persistence
      - config:/home/claude/.config

    ports:
      - "2222:22"
    working_dir: /workspace

volumes:
  claude-config:
    name: deco-claude-config
  config:
    name: deco-config
